<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reset Password</title>
  <style>
    /* http://meyerweb.com/eric/tools/css/reset/ 
   v2.0 | 20110126
   License: none (public domain)
*/

    html,
    body,
    div,
    span,
    applet,
    object,
    iframe,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    blockquote,
    pre,
    a,
    abbr,
    acronym,
    address,
    big,
    cite,
    code,
    del,
    dfn,
    em,
    img,
    ins,
    kbd,
    q,
    s,
    samp,
    small,
    strike,
    strong,
    sub,
    sup,
    tt,
    var,
    b,
    u,
    i,
    center,
    dl,
    dt,
    dd,
    ol,
    ul,
    li,
    fieldset,
    form,
    label,
    legend,
    table,
    caption,
    tbody,
    tfoot,
    thead,
    tr,
    th,
    td,
    article,
    aside,
    canvas,
    details,
    embed,
    figure,
    figcaption,
    footer,
    header,
    hgroup,
    menu,
    nav,
    output,
    ruby,
    section,
    summary,
    time,
    mark,
    audio,
    video {
      margin: 0;
      padding: 0;
      border: 0;
      font-size: 100%;
      font: inherit;
      vertical-align: baseline;
    }

    /* HTML5 display-role reset for older browsers */
    article,
    aside,
    details,
    figcaption,
    figure,
    footer,
    header,
    hgroup,
    menu,
    nav,
    section {
      display: block;
    }

    body {
      line-height: 1;
    }

    ol,
    ul {
      list-style: none;
    }

    blockquote,
    q {
      quotes: none;
    }

    blockquote:before,
    blockquote:after,
    q:before,
    q:after {
      content: '';
      content: none;
    }

    table {
      border-collapse: collapse;
      border-spacing: 0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header,
    footer {
      width: 100%;
      height: 100px;
      flex-shrink: 0;
    }

    main {
      flex-grow: 1;
    }

    /* Customizable */

    .cursor-pointer {
      cursor: pointer !important;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body>

  <header class="w-100 p-5 d-flex flex-row-reverse">
    <a class="nav-link" id="darkLightMode" mode="light" href="#"><svg xmlns="http://www.w3.org/2000/svg"
        local="https://icons.getbootstrap.com/icons/brightness-high-fill/" width="16" height="16" fill="currentColor"
        class="bi bi-sun-fill" viewBox="0 0 16 16">
        <path
          d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708" />
      </svg>
    </a>
  </header>

  <main>
    <section class="w-100 h-100 d-flex justify-content-center align-items-center text-center flex-column">
      <article>
        <a class="nav-link" href="home.html">
          <svg xmlns="http://www.w3.org/2000/svg" local="https://icons.getbootstrap.com/icons/code-square/" width="64"
            height="64" fill="currentColor" class="bi bi-code-square m-3 cursor-pointer" viewBox="0 0 16 16">
            <path
              d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z">
            </path>
            <path
              d="M6.854 4.646a.5.5 0 0 1 0 .708L4.207 8l2.647 2.646a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 0 1 .708 0m2.292 0a.5.5 0 0 0 0 .708L11.793 8l-2.647 2.646a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708 0">
            </path>
          </svg>
        </a>
        <h2>Please reset your password</h2>
        <form id="resetPasswordForm">
          <input class="form-control m-1" type="email" id="email" placeholder="Email" required disabled />
          <input class="form-control m-1" type="password" id="password" placeholder="New password" required />
          <input class="form-control m-1" type="password" id="password_confirmation" placeholder="Confirm password"
            required />
          <p class="fw-lighter" id="message"></p>
          <button class="btn btn-primary" type="submit">Reset Password</button>
        </form>

        <a href="login.html">Login</a>
      </article>
    </section>
  </main>

  <footer></footer>

  <script src="app.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>
  <script>
    //Beginning request
    function showLoadingPopup(message = `<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>`) {
      const popup = document.createElement("div");
      popup.innerHTML = message;
      popup.id = "loading-popup";
      popup.style.position = "fixed";
      popup.style.top = "20px";
      popup.style.right = "20px";
      popup.style.background = "#333";
      popup.style.color = "#fff";
      popup.style.padding = "10px 15px";
      popup.style.borderRadius = "5px";
      popup.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
      popup.style.fontSize = "16px";
      popup.style.zIndex = "9999";
      popup.style.opacity = "1";
      popup.style.transition = "opacity 0.3s ease-out";
      popup.style.pointerEvents = "none";
      popup.className = 'popup'

      document.querySelectorAll('.popup').forEach(el => el.remove());
      if (!document.getElementById("loading-popup")) {
        document.body.appendChild(popup);
      }
    }
    function hideLoadingPopup() {
      const popup = document.getElementById("loading-popup");
      if (popup) {
        popup.style.opacity = "0";
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 300);
      }
    }
    function showErrorPopup(message = `<div class="spinner-grow text-light" role="status">
  <span class="visually-hidden">Loading...</span>
</div>`) {
      const popup = document.createElement("div");
      popup.innerHTML = message;
      popup.style.position = "fixed";
      popup.style.top = "20px";
      popup.style.right = "20px";
      popup.style.background = "#f44336"; // red background
      popup.style.color = "#fff";
      popup.style.padding = "10px 15px";
      popup.style.borderRadius = "5px";
      popup.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
      popup.style.fontSize = "16px";
      popup.style.zIndex = "9999";
      popup.style.opacity = "1";
      popup.style.transition = "opacity 1s ease-out";
      popup.style.pointerEvents = "none";
      popup.className = 'popup'

      document.querySelectorAll('.popup').forEach(el => el.remove());
      document.body.appendChild(popup);

      // Fade out after 1.5 seconds
      setTimeout(() => {
        popup.style.opacity = "0";
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 1000);
      }, 1500);
    }
    function showSuccessPopup(message = `<div class="spinner-grow text-light" role="status">
  <span class="visually-hidden">Loading...</span>
</div>`) {
      const popup = document.createElement("div");
      popup.innerHTML = message;
      popup.style.position = "fixed";
      popup.style.top = "20px";
      popup.style.right = "20px";
      popup.style.background = "#4caf50"; // green background
      popup.style.color = "#fff";
      popup.style.padding = "10px 15px";
      popup.style.borderRadius = "5px";
      popup.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
      popup.style.fontSize = "16px";
      popup.style.zIndex = "9999";
      popup.style.opacity = "1";
      popup.style.transition = "opacity 1s ease-out";
      popup.style.pointerEvents = "none";
      popup.className = 'popup'


      document.querySelectorAll('.popup').forEach(el => el.remove());
      document.body.appendChild(popup);

      // Fade out after 1.5 seconds
      setTimeout(() => {
        popup.style.opacity = "0";
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 1000);
      }, 1500);
    }


    const apiUrl = 'http://127.0.0.1:8000/api'; // change if needed
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const emailFromUrl = urlParams.get('email');

    document.getElementById('email').value = emailFromUrl || '';


    document.getElementById('resetPasswordForm').addEventListener('submit', async function (e) {
      e.preventDefault();


      if (document.getElementById('password').value !== document.getElementById('password').value.trim().replace(/\s+/g, "")) {
        alert('Password must not contain spaces')
        return;
      }

      if (document.getElementById('password_confirmation').value !== document.getElementById('password_confirmation').value.trim().replace(/\s+/g, "")) {
        alert('Password must not contain spaces')
        return;
      }

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value.trim().replace(/\s+/g, "");
      const password_confirmation = document.getElementById('password_confirmation').value.trim().replace(/\s+/g, "");




      showLoadingPopup()
      try {
        await fetch('http://127.0.0.1:8000/sanctum/csrf-cookie', {
          credentials: 'include'
        });
        const csrfToken = decodeURIComponent(getCookie('XSRF-TOKEN'));

        const response = await fetch(`${apiUrl}/reset-password`, {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json', Accept: 'application/json', 'X-XSRF-TOKEN': csrfToken },
          body: JSON.stringify({
            token,
            email,
            password,
            password_confirmation
          })
        });

        const data = await response.json();

        if (response.ok) {
          document.getElementById('message').innerText = data.message || 'Something went wrong';
          showSuccessPopup()
        }
        else {
          document.getElementById('message').innerText = `${data.message}: ${data.error}` || 'An unknown error occurred';
          showErrorPopup()
        }

      } catch (error) {
        document.getElementById('message').innerText = error.message || 'An unknown error occurred';
        showErrorPopup()
      }
      finally {
        hideLoadingPopup()
      }

    });
  </script>
  <script>
    //getCookie
    function getCookie(name) {
      const match = document.cookie.match(
        new RegExp('(^|; )' + name.replace(/([.$?*|{}()[\]\\/+^])/g, '\\$1') + '=([^;]*)')
      );
      return match ? match[2] : '';
    }
  </script>
</body>

</html>



<!-- <h2>Reset Password</h2>
  <form id="resetPasswordForm">
    <input type="email" id="email" placeholder="Email" required disabled />
    <input type="password" id="password" placeholder="New password" required />
    <input type="password" id="password_confirmation" placeholder="Confirm password" required />
    <button type="submit">Reset Password</button>
  </form>

  <a href="home.html">üè† Back to Home</a> |
  <a href="login.html">Login</a> |
  <p id="message"></p> -->